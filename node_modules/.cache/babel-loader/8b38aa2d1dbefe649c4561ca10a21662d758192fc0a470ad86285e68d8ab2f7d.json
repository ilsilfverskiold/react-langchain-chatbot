{"ast":null,"code":"function RetryOperation(timeouts, options) {\n  // Compatibility for the old (timeouts, retryForever) signature\n  if (typeof options === 'boolean') {\n    options = {\n      forever: options\n    };\n  }\n  this._originalTimeouts = JSON.parse(JSON.stringify(timeouts));\n  this._timeouts = timeouts;\n  this._options = options || {};\n  this._maxRetryTime = options && options.maxRetryTime || Infinity;\n  this._fn = null;\n  this._errors = [];\n  this._attempts = 1;\n  this._operationTimeout = null;\n  this._operationTimeoutCb = null;\n  this._timeout = null;\n  this._operationStart = null;\n  this._timer = null;\n  if (this._options.forever) {\n    this._cachedTimeouts = this._timeouts.slice(0);\n  }\n}\nmodule.exports = RetryOperation;\nRetryOperation.prototype.reset = function () {\n  this._attempts = 1;\n  this._timeouts = this._originalTimeouts.slice(0);\n};\nRetryOperation.prototype.stop = function () {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n  if (this._timer) {\n    clearTimeout(this._timer);\n  }\n  this._timeouts = [];\n  this._cachedTimeouts = null;\n};\nRetryOperation.prototype.retry = function (err) {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n  if (!err) {\n    return false;\n  }\n  var currentTime = new Date().getTime();\n  if (err && currentTime - this._operationStart >= this._maxRetryTime) {\n    this._errors.push(err);\n    this._errors.unshift(new Error('RetryOperation timeout occurred'));\n    return false;\n  }\n  this._errors.push(err);\n  var timeout = this._timeouts.shift();\n  if (timeout === undefined) {\n    if (this._cachedTimeouts) {\n      // retry forever, only keep last error\n      this._errors.splice(0, this._errors.length - 1);\n      timeout = this._cachedTimeouts.slice(-1);\n    } else {\n      return false;\n    }\n  }\n  var self = this;\n  this._timer = setTimeout(function () {\n    self._attempts++;\n    if (self._operationTimeoutCb) {\n      self._timeout = setTimeout(function () {\n        self._operationTimeoutCb(self._attempts);\n      }, self._operationTimeout);\n      if (self._options.unref) {\n        self._timeout.unref();\n      }\n    }\n    self._fn(self._attempts);\n  }, timeout);\n  if (this._options.unref) {\n    this._timer.unref();\n  }\n  return true;\n};\nRetryOperation.prototype.attempt = function (fn, timeoutOps) {\n  this._fn = fn;\n  if (timeoutOps) {\n    if (timeoutOps.timeout) {\n      this._operationTimeout = timeoutOps.timeout;\n    }\n    if (timeoutOps.cb) {\n      this._operationTimeoutCb = timeoutOps.cb;\n    }\n  }\n  var self = this;\n  if (this._operationTimeoutCb) {\n    this._timeout = setTimeout(function () {\n      self._operationTimeoutCb();\n    }, self._operationTimeout);\n  }\n  this._operationStart = new Date().getTime();\n  this._fn(this._attempts);\n};\nRetryOperation.prototype.try = function (fn) {\n  console.log('Using RetryOperation.try() is deprecated');\n  this.attempt(fn);\n};\nRetryOperation.prototype.start = function (fn) {\n  console.log('Using RetryOperation.start() is deprecated');\n  this.attempt(fn);\n};\nRetryOperation.prototype.start = RetryOperation.prototype.try;\nRetryOperation.prototype.errors = function () {\n  return this._errors;\n};\nRetryOperation.prototype.attempts = function () {\n  return this._attempts;\n};\nRetryOperation.prototype.mainError = function () {\n  if (this._errors.length === 0) {\n    return null;\n  }\n  var counts = {};\n  var mainError = null;\n  var mainErrorCount = 0;\n  for (var i = 0; i < this._errors.length; i++) {\n    var error = this._errors[i];\n    var message = error.message;\n    var count = (counts[message] || 0) + 1;\n    counts[message] = count;\n    if (count >= mainErrorCount) {\n      mainError = error;\n      mainErrorCount = count;\n    }\n  }\n  return mainError;\n};","map":{"version":3,"names":["RetryOperation","timeouts","options","forever","_originalTimeouts","JSON","parse","stringify","_timeouts","_options","_maxRetryTime","maxRetryTime","Infinity","_fn","_errors","_attempts","_operationTimeout","_operationTimeoutCb","_timeout","_operationStart","_timer","_cachedTimeouts","slice","module","exports","prototype","reset","stop","clearTimeout","retry","err","currentTime","Date","getTime","push","unshift","Error","timeout","shift","undefined","splice","length","self","setTimeout","unref","attempt","fn","timeoutOps","cb","try","console","log","start","errors","attempts","mainError","counts","mainErrorCount","i","error","message","count"],"sources":["/Users/idasilfverskiold/gptSandbox/reactlangchain/sandbox/node_modules/retry/lib/retry_operation.js"],"sourcesContent":["function RetryOperation(timeouts, options) {\n  // Compatibility for the old (timeouts, retryForever) signature\n  if (typeof options === 'boolean') {\n    options = { forever: options };\n  }\n\n  this._originalTimeouts = JSON.parse(JSON.stringify(timeouts));\n  this._timeouts = timeouts;\n  this._options = options || {};\n  this._maxRetryTime = options && options.maxRetryTime || Infinity;\n  this._fn = null;\n  this._errors = [];\n  this._attempts = 1;\n  this._operationTimeout = null;\n  this._operationTimeoutCb = null;\n  this._timeout = null;\n  this._operationStart = null;\n  this._timer = null;\n\n  if (this._options.forever) {\n    this._cachedTimeouts = this._timeouts.slice(0);\n  }\n}\nmodule.exports = RetryOperation;\n\nRetryOperation.prototype.reset = function() {\n  this._attempts = 1;\n  this._timeouts = this._originalTimeouts.slice(0);\n}\n\nRetryOperation.prototype.stop = function() {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n  if (this._timer) {\n    clearTimeout(this._timer);\n  }\n\n  this._timeouts       = [];\n  this._cachedTimeouts = null;\n};\n\nRetryOperation.prototype.retry = function(err) {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n\n  if (!err) {\n    return false;\n  }\n  var currentTime = new Date().getTime();\n  if (err && currentTime - this._operationStart >= this._maxRetryTime) {\n    this._errors.push(err);\n    this._errors.unshift(new Error('RetryOperation timeout occurred'));\n    return false;\n  }\n\n  this._errors.push(err);\n\n  var timeout = this._timeouts.shift();\n  if (timeout === undefined) {\n    if (this._cachedTimeouts) {\n      // retry forever, only keep last error\n      this._errors.splice(0, this._errors.length - 1);\n      timeout = this._cachedTimeouts.slice(-1);\n    } else {\n      return false;\n    }\n  }\n\n  var self = this;\n  this._timer = setTimeout(function() {\n    self._attempts++;\n\n    if (self._operationTimeoutCb) {\n      self._timeout = setTimeout(function() {\n        self._operationTimeoutCb(self._attempts);\n      }, self._operationTimeout);\n\n      if (self._options.unref) {\n          self._timeout.unref();\n      }\n    }\n\n    self._fn(self._attempts);\n  }, timeout);\n\n  if (this._options.unref) {\n      this._timer.unref();\n  }\n\n  return true;\n};\n\nRetryOperation.prototype.attempt = function(fn, timeoutOps) {\n  this._fn = fn;\n\n  if (timeoutOps) {\n    if (timeoutOps.timeout) {\n      this._operationTimeout = timeoutOps.timeout;\n    }\n    if (timeoutOps.cb) {\n      this._operationTimeoutCb = timeoutOps.cb;\n    }\n  }\n\n  var self = this;\n  if (this._operationTimeoutCb) {\n    this._timeout = setTimeout(function() {\n      self._operationTimeoutCb();\n    }, self._operationTimeout);\n  }\n\n  this._operationStart = new Date().getTime();\n\n  this._fn(this._attempts);\n};\n\nRetryOperation.prototype.try = function(fn) {\n  console.log('Using RetryOperation.try() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = function(fn) {\n  console.log('Using RetryOperation.start() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = RetryOperation.prototype.try;\n\nRetryOperation.prototype.errors = function() {\n  return this._errors;\n};\n\nRetryOperation.prototype.attempts = function() {\n  return this._attempts;\n};\n\nRetryOperation.prototype.mainError = function() {\n  if (this._errors.length === 0) {\n    return null;\n  }\n\n  var counts = {};\n  var mainError = null;\n  var mainErrorCount = 0;\n\n  for (var i = 0; i < this._errors.length; i++) {\n    var error = this._errors[i];\n    var message = error.message;\n    var count = (counts[message] || 0) + 1;\n\n    counts[message] = count;\n\n    if (count >= mainErrorCount) {\n      mainError = error;\n      mainErrorCount = count;\n    }\n  }\n\n  return mainError;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}