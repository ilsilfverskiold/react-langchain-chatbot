{"ast":null,"code":"import { v4 as uuidv4 } from \"uuid\";\nimport { BaseCallbackHandler } from \"./base.js\";\nimport { ConsoleCallbackHandler } from \"./handlers/console.js\";\nimport { getTracingCallbackHandler, getTracingV2CallbackHandler } from \"./handlers/initialize.js\";\nimport { getBufferString } from \"../memory/base.js\";\nimport { getEnvironmentVariable } from \"../util/env.js\";\nimport { LangChainTracer } from \"./handlers/tracer_langchain.js\";\nimport { consumeCallback } from \"./promises.js\";\nexport function parseCallbackConfigArg(arg) {\n  if (!arg) {\n    return {};\n  } else if (Array.isArray(arg) || \"name\" in arg) {\n    return {\n      callbacks: arg\n    };\n  } else {\n    return arg;\n  }\n}\nexport class BaseCallbackManager {\n  setHandler(handler) {\n    return this.setHandlers([handler]);\n  }\n}\nclass BaseRunManager {\n  constructor(runId, handlers, inheritableHandlers, tags, inheritableTags, metadata, inheritableMetadata, _parentRunId) {\n    Object.defineProperty(this, \"runId\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: runId\n    });\n    Object.defineProperty(this, \"handlers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: handlers\n    });\n    Object.defineProperty(this, \"inheritableHandlers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: inheritableHandlers\n    });\n    Object.defineProperty(this, \"tags\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: tags\n    });\n    Object.defineProperty(this, \"inheritableTags\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: inheritableTags\n    });\n    Object.defineProperty(this, \"metadata\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: metadata\n    });\n    Object.defineProperty(this, \"inheritableMetadata\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: inheritableMetadata\n    });\n    Object.defineProperty(this, \"_parentRunId\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _parentRunId\n    });\n  }\n  async handleText(text) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      try {\n        await handler.handleText?.(text, this.runId, this._parentRunId, this.tags);\n      } catch (err) {\n        console.error(`Error in handler ${handler.constructor.name}, handleText: ${err}`);\n      }\n    }, handler.awaitHandlers)));\n  }\n}\nexport class CallbackManagerForRetrieverRun extends BaseRunManager {\n  getChild(tag) {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    const manager = new CallbackManager(this.runId);\n    manager.setHandlers(this.inheritableHandlers);\n    manager.addTags(this.inheritableTags);\n    manager.addMetadata(this.inheritableMetadata);\n    if (tag) {\n      manager.addTags([tag], false);\n    }\n    return manager;\n  }\n  async handleRetrieverEnd(documents) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreRetriever) {\n        try {\n          await handler.handleRetrieverEnd?.(documents, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleRetriever`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n  async handleRetrieverError(err) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreRetriever) {\n        try {\n          await handler.handleRetrieverError?.(err, this.runId, this._parentRunId, this.tags);\n        } catch (error) {\n          console.error(`Error in handler ${handler.constructor.name}, handleRetrieverError: ${error}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n}\nexport class CallbackManagerForLLMRun extends BaseRunManager {\n  async handleLLMNewToken(token, idx = {\n    prompt: 0,\n    completion: 0\n  }) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreLLM) {\n        try {\n          await handler.handleLLMNewToken?.(token, idx, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleLLMNewToken: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n  async handleLLMError(err) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreLLM) {\n        try {\n          await handler.handleLLMError?.(err, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleLLMError: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n  async handleLLMEnd(output) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreLLM) {\n        try {\n          await handler.handleLLMEnd?.(output, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleLLMEnd: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n}\nexport class CallbackManagerForChainRun extends BaseRunManager {\n  getChild(tag) {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    const manager = new CallbackManager(this.runId);\n    manager.setHandlers(this.inheritableHandlers);\n    manager.addTags(this.inheritableTags);\n    manager.addMetadata(this.inheritableMetadata);\n    if (tag) {\n      manager.addTags([tag], false);\n    }\n    return manager;\n  }\n  async handleChainError(err) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreChain) {\n        try {\n          await handler.handleChainError?.(err, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleChainError: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n  async handleChainEnd(output) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreChain) {\n        try {\n          await handler.handleChainEnd?.(output, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleChainEnd: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n  async handleAgentAction(action) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreAgent) {\n        try {\n          await handler.handleAgentAction?.(action, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleAgentAction: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n  async handleAgentEnd(action) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreAgent) {\n        try {\n          await handler.handleAgentEnd?.(action, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleAgentEnd: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n}\nexport class CallbackManagerForToolRun extends BaseRunManager {\n  getChild(tag) {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    const manager = new CallbackManager(this.runId);\n    manager.setHandlers(this.inheritableHandlers);\n    manager.addTags(this.inheritableTags);\n    manager.addMetadata(this.inheritableMetadata);\n    if (tag) {\n      manager.addTags([tag], false);\n    }\n    return manager;\n  }\n  async handleToolError(err) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreAgent) {\n        try {\n          await handler.handleToolError?.(err, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleToolError: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n  async handleToolEnd(output) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreAgent) {\n        try {\n          await handler.handleToolEnd?.(output, this.runId, this._parentRunId, this.tags);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleToolEnd: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n  }\n}\nexport class CallbackManager extends BaseCallbackManager {\n  constructor(parentRunId) {\n    super();\n    Object.defineProperty(this, \"handlers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"inheritableHandlers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"tags\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: []\n    });\n    Object.defineProperty(this, \"inheritableTags\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: []\n    });\n    Object.defineProperty(this, \"metadata\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, \"inheritableMetadata\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(this, \"name\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"callback_manager\"\n    });\n    Object.defineProperty(this, \"_parentRunId\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    this.handlers = [];\n    this.inheritableHandlers = [];\n    this._parentRunId = parentRunId;\n  }\n  async handleLLMStart(llm, prompts, _runId = undefined, _parentRunId = undefined, extraParams = undefined) {\n    return Promise.all(prompts.map(async prompt => {\n      const runId = uuidv4();\n      await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n        if (!handler.ignoreLLM) {\n          try {\n            await handler.handleLLMStart?.(llm, [prompt], runId, this._parentRunId, extraParams, this.tags, this.metadata);\n          } catch (err) {\n            console.error(`Error in handler ${handler.constructor.name}, handleLLMStart: ${err}`);\n          }\n        }\n      }, handler.awaitHandlers)));\n      return new CallbackManagerForLLMRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n    }));\n  }\n  async handleChatModelStart(llm, messages, _runId = undefined, _parentRunId = undefined, extraParams = undefined) {\n    return Promise.all(messages.map(async messageGroup => {\n      const runId = uuidv4();\n      await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n        if (!handler.ignoreLLM) {\n          try {\n            if (handler.handleChatModelStart) await handler.handleChatModelStart?.(llm, [messageGroup], runId, this._parentRunId, extraParams, this.tags, this.metadata);else if (handler.handleLLMStart) {\n              const messageString = getBufferString(messageGroup);\n              await handler.handleLLMStart?.(llm, [messageString], runId, this._parentRunId, extraParams, this.tags, this.metadata);\n            }\n          } catch (err) {\n            console.error(`Error in handler ${handler.constructor.name}, handleLLMStart: ${err}`);\n          }\n        }\n      }, handler.awaitHandlers)));\n      return new CallbackManagerForLLMRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n    }));\n  }\n  async handleChainStart(chain, inputs, runId = uuidv4(), runType = undefined) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreChain) {\n        try {\n          await handler.handleChainStart?.(chain, inputs, runId, this._parentRunId, this.tags, this.metadata, runType);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleChainStart: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n    return new CallbackManagerForChainRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n  }\n  async handleToolStart(tool, input, runId = uuidv4()) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreAgent) {\n        try {\n          await handler.handleToolStart?.(tool, input, runId, this._parentRunId, this.tags, this.metadata);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleToolStart: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n    return new CallbackManagerForToolRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n  }\n  async handleRetrieverStart(retriever, query, runId = uuidv4(), _parentRunId = undefined) {\n    await Promise.all(this.handlers.map(handler => consumeCallback(async () => {\n      if (!handler.ignoreRetriever) {\n        try {\n          await handler.handleRetrieverStart?.(retriever, query, runId, this._parentRunId, this.tags, this.metadata);\n        } catch (err) {\n          console.error(`Error in handler ${handler.constructor.name}, handleRetrieverStart: ${err}`);\n        }\n      }\n    }, handler.awaitHandlers)));\n    return new CallbackManagerForRetrieverRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n  }\n  addHandler(handler, inherit = true) {\n    this.handlers.push(handler);\n    if (inherit) {\n      this.inheritableHandlers.push(handler);\n    }\n  }\n  removeHandler(handler) {\n    this.handlers = this.handlers.filter(_handler => _handler !== handler);\n    this.inheritableHandlers = this.inheritableHandlers.filter(_handler => _handler !== handler);\n  }\n  setHandlers(handlers, inherit = true) {\n    this.handlers = [];\n    this.inheritableHandlers = [];\n    for (const handler of handlers) {\n      this.addHandler(handler, inherit);\n    }\n  }\n  addTags(tags, inherit = true) {\n    this.removeTags(tags); // Remove duplicates\n    this.tags.push(...tags);\n    if (inherit) {\n      this.inheritableTags.push(...tags);\n    }\n  }\n  removeTags(tags) {\n    this.tags = this.tags.filter(tag => !tags.includes(tag));\n    this.inheritableTags = this.inheritableTags.filter(tag => !tags.includes(tag));\n  }\n  addMetadata(metadata, inherit = true) {\n    this.metadata = {\n      ...this.metadata,\n      ...metadata\n    };\n    if (inherit) {\n      this.inheritableMetadata = {\n        ...this.inheritableMetadata,\n        ...metadata\n      };\n    }\n  }\n  removeMetadata(metadata) {\n    for (const key of Object.keys(metadata)) {\n      delete this.metadata[key];\n      delete this.inheritableMetadata[key];\n    }\n  }\n  copy(additionalHandlers = [], inherit = true) {\n    const manager = new CallbackManager(this._parentRunId);\n    for (const handler of this.handlers) {\n      const inheritable = this.inheritableHandlers.includes(handler);\n      manager.addHandler(handler, inheritable);\n    }\n    for (const tag of this.tags) {\n      const inheritable = this.inheritableTags.includes(tag);\n      manager.addTags([tag], inheritable);\n    }\n    for (const key of Object.keys(this.metadata)) {\n      const inheritable = Object.keys(this.inheritableMetadata).includes(key);\n      manager.addMetadata({\n        [key]: this.metadata[key]\n      }, inheritable);\n    }\n    for (const handler of additionalHandlers) {\n      if (\n      // Prevent multiple copies of console_callback_handler\n      manager.handlers.filter(h => h.name === \"console_callback_handler\").some(h => h.name === handler.name)) {\n        continue;\n      }\n      manager.addHandler(handler, inherit);\n    }\n    return manager;\n  }\n  static fromHandlers(handlers) {\n    class Handler extends BaseCallbackHandler {\n      constructor() {\n        super();\n        Object.defineProperty(this, \"name\", {\n          enumerable: true,\n          configurable: true,\n          writable: true,\n          value: uuidv4()\n        });\n        Object.assign(this, handlers);\n      }\n    }\n    const manager = new this();\n    manager.addHandler(new Handler());\n    return manager;\n  }\n  static async configure(inheritableHandlers, localHandlers, inheritableTags, localTags, inheritableMetadata, localMetadata, options) {\n    let callbackManager;\n    if (inheritableHandlers || localHandlers) {\n      if (Array.isArray(inheritableHandlers) || !inheritableHandlers) {\n        callbackManager = new CallbackManager();\n        callbackManager.setHandlers(inheritableHandlers?.map(ensureHandler) ?? [], true);\n      } else {\n        callbackManager = inheritableHandlers;\n      }\n      callbackManager = callbackManager.copy(Array.isArray(localHandlers) ? localHandlers.map(ensureHandler) : localHandlers?.handlers, false);\n    }\n    const verboseEnabled = getEnvironmentVariable(\"LANGCHAIN_VERBOSE\") || options?.verbose;\n    const tracingV2Enabled = getEnvironmentVariable(\"LANGCHAIN_TRACING_V2\") === \"true\";\n    const tracingEnabled = tracingV2Enabled || (getEnvironmentVariable(\"LANGCHAIN_TRACING\") ?? false);\n    if (verboseEnabled || tracingEnabled) {\n      if (!callbackManager) {\n        callbackManager = new CallbackManager();\n      }\n      if (verboseEnabled && !callbackManager.handlers.some(handler => handler.name === ConsoleCallbackHandler.prototype.name)) {\n        const consoleHandler = new ConsoleCallbackHandler();\n        callbackManager.addHandler(consoleHandler, true);\n      }\n      if (tracingEnabled && !callbackManager.handlers.some(handler => handler.name === \"langchain_tracer\")) {\n        if (tracingV2Enabled) {\n          callbackManager.addHandler(await getTracingV2CallbackHandler(), true);\n        } else {\n          const session = getEnvironmentVariable(\"LANGCHAIN_PROJECT\") && getEnvironmentVariable(\"LANGCHAIN_SESSION\");\n          callbackManager.addHandler(await getTracingCallbackHandler(session), true);\n        }\n      }\n    }\n    if (inheritableTags || localTags) {\n      if (callbackManager) {\n        callbackManager.addTags(inheritableTags ?? []);\n        callbackManager.addTags(localTags ?? [], false);\n      }\n    }\n    if (inheritableMetadata || localMetadata) {\n      if (callbackManager) {\n        callbackManager.addMetadata(inheritableMetadata ?? {});\n        callbackManager.addMetadata(localMetadata ?? {}, false);\n      }\n    }\n    return callbackManager;\n  }\n}\nfunction ensureHandler(handler) {\n  if (\"name\" in handler) {\n    return handler;\n  }\n  return BaseCallbackHandler.fromMethods(handler);\n}\nexport class TraceGroup {\n  constructor(groupName, options) {\n    Object.defineProperty(this, \"groupName\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: groupName\n    });\n    Object.defineProperty(this, \"options\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: options\n    });\n    Object.defineProperty(this, \"runManager\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n  }\n  async getTraceGroupCallbackManager(group_name, options) {\n    const cb = new LangChainTracer(options);\n    const cm = await CallbackManager.configure([cb]);\n    const runManager = await cm?.handleChainStart({\n      lc: 1,\n      type: \"not_implemented\",\n      id: [\"langchain\", \"callbacks\", \"groups\", group_name]\n    }, {});\n    if (!runManager) {\n      throw new Error(\"Failed to create run group callback manager.\");\n    }\n    return runManager;\n  }\n  async start() {\n    if (!this.runManager) {\n      this.runManager = await this.getTraceGroupCallbackManager(this.groupName, this.options);\n    }\n    return this.runManager.getChild();\n  }\n  async end() {\n    if (this.runManager) {\n      await this.runManager.handleChainEnd({});\n      this.runManager = undefined;\n    }\n  }\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport async function traceAsGroup(groupOptions, enclosedCode, ...args) {\n  const traceGroup = new TraceGroup(groupOptions.name, groupOptions);\n  const callbackManager = await traceGroup.start();\n  try {\n    return await enclosedCode(callbackManager, ...args);\n  } finally {\n    await traceGroup.end();\n  }\n}","map":{"version":3,"names":["v4","uuidv4","BaseCallbackHandler","ConsoleCallbackHandler","getTracingCallbackHandler","getTracingV2CallbackHandler","getBufferString","getEnvironmentVariable","LangChainTracer","consumeCallback","parseCallbackConfigArg","arg","Array","isArray","callbacks","BaseCallbackManager","setHandler","handler","setHandlers","BaseRunManager","constructor","runId","handlers","inheritableHandlers","tags","inheritableTags","metadata","inheritableMetadata","_parentRunId","Object","defineProperty","enumerable","configurable","writable","value","handleText","text","Promise","all","map","err","console","error","name","awaitHandlers","CallbackManagerForRetrieverRun","getChild","tag","manager","CallbackManager","addTags","addMetadata","handleRetrieverEnd","documents","ignoreRetriever","handleRetrieverError","CallbackManagerForLLMRun","handleLLMNewToken","token","idx","prompt","completion","ignoreLLM","handleLLMError","handleLLMEnd","output","CallbackManagerForChainRun","handleChainError","ignoreChain","handleChainEnd","handleAgentAction","action","ignoreAgent","handleAgentEnd","CallbackManagerForToolRun","handleToolError","handleToolEnd","parentRunId","handleLLMStart","llm","prompts","_runId","undefined","extraParams","handleChatModelStart","messages","messageGroup","messageString","handleChainStart","chain","inputs","runType","handleToolStart","tool","input","handleRetrieverStart","retriever","query","addHandler","inherit","push","removeHandler","filter","_handler","removeTags","includes","removeMetadata","key","keys","copy","additionalHandlers","inheritable","h","some","fromHandlers","Handler","assign","configure","localHandlers","localTags","localMetadata","options","callbackManager","ensureHandler","verboseEnabled","verbose","tracingV2Enabled","tracingEnabled","prototype","consoleHandler","session","fromMethods","TraceGroup","groupName","getTraceGroupCallbackManager","group_name","cb","cm","runManager","lc","type","id","Error","start","end","traceAsGroup","groupOptions","enclosedCode","args","traceGroup"],"sources":["/Users/idasilfverskiold/gptSandbox/reactlangchain/sandbox/node_modules/langchain/dist/callbacks/manager.js"],"sourcesContent":["import { v4 as uuidv4 } from \"uuid\";\nimport { BaseCallbackHandler, } from \"./base.js\";\nimport { ConsoleCallbackHandler } from \"./handlers/console.js\";\nimport { getTracingCallbackHandler, getTracingV2CallbackHandler, } from \"./handlers/initialize.js\";\nimport { getBufferString } from \"../memory/base.js\";\nimport { getEnvironmentVariable } from \"../util/env.js\";\nimport { LangChainTracer, } from \"./handlers/tracer_langchain.js\";\nimport { consumeCallback } from \"./promises.js\";\nexport function parseCallbackConfigArg(arg) {\n    if (!arg) {\n        return {};\n    }\n    else if (Array.isArray(arg) || \"name\" in arg) {\n        return { callbacks: arg };\n    }\n    else {\n        return arg;\n    }\n}\nexport class BaseCallbackManager {\n    setHandler(handler) {\n        return this.setHandlers([handler]);\n    }\n}\nclass BaseRunManager {\n    constructor(runId, handlers, inheritableHandlers, tags, inheritableTags, metadata, inheritableMetadata, _parentRunId) {\n        Object.defineProperty(this, \"runId\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: runId\n        });\n        Object.defineProperty(this, \"handlers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: handlers\n        });\n        Object.defineProperty(this, \"inheritableHandlers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: inheritableHandlers\n        });\n        Object.defineProperty(this, \"tags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: tags\n        });\n        Object.defineProperty(this, \"inheritableTags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: inheritableTags\n        });\n        Object.defineProperty(this, \"metadata\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: metadata\n        });\n        Object.defineProperty(this, \"inheritableMetadata\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: inheritableMetadata\n        });\n        Object.defineProperty(this, \"_parentRunId\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: _parentRunId\n        });\n    }\n    async handleText(text) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            try {\n                await handler.handleText?.(text, this.runId, this._parentRunId, this.tags);\n            }\n            catch (err) {\n                console.error(`Error in handler ${handler.constructor.name}, handleText: ${err}`);\n            }\n        }, handler.awaitHandlers)));\n    }\n}\nexport class CallbackManagerForRetrieverRun extends BaseRunManager {\n    getChild(tag) {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        const manager = new CallbackManager(this.runId);\n        manager.setHandlers(this.inheritableHandlers);\n        manager.addTags(this.inheritableTags);\n        manager.addMetadata(this.inheritableMetadata);\n        if (tag) {\n            manager.addTags([tag], false);\n        }\n        return manager;\n    }\n    async handleRetrieverEnd(documents) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreRetriever) {\n                try {\n                    await handler.handleRetrieverEnd?.(documents, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleRetriever`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n    async handleRetrieverError(err) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreRetriever) {\n                try {\n                    await handler.handleRetrieverError?.(err, this.runId, this._parentRunId, this.tags);\n                }\n                catch (error) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleRetrieverError: ${error}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n}\nexport class CallbackManagerForLLMRun extends BaseRunManager {\n    async handleLLMNewToken(token, idx = { prompt: 0, completion: 0 }) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreLLM) {\n                try {\n                    await handler.handleLLMNewToken?.(token, idx, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleLLMNewToken: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n    async handleLLMError(err) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreLLM) {\n                try {\n                    await handler.handleLLMError?.(err, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleLLMError: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n    async handleLLMEnd(output) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreLLM) {\n                try {\n                    await handler.handleLLMEnd?.(output, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleLLMEnd: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n}\nexport class CallbackManagerForChainRun extends BaseRunManager {\n    getChild(tag) {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        const manager = new CallbackManager(this.runId);\n        manager.setHandlers(this.inheritableHandlers);\n        manager.addTags(this.inheritableTags);\n        manager.addMetadata(this.inheritableMetadata);\n        if (tag) {\n            manager.addTags([tag], false);\n        }\n        return manager;\n    }\n    async handleChainError(err) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreChain) {\n                try {\n                    await handler.handleChainError?.(err, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleChainError: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n    async handleChainEnd(output) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreChain) {\n                try {\n                    await handler.handleChainEnd?.(output, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleChainEnd: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n    async handleAgentAction(action) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreAgent) {\n                try {\n                    await handler.handleAgentAction?.(action, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleAgentAction: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n    async handleAgentEnd(action) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreAgent) {\n                try {\n                    await handler.handleAgentEnd?.(action, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleAgentEnd: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n}\nexport class CallbackManagerForToolRun extends BaseRunManager {\n    getChild(tag) {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        const manager = new CallbackManager(this.runId);\n        manager.setHandlers(this.inheritableHandlers);\n        manager.addTags(this.inheritableTags);\n        manager.addMetadata(this.inheritableMetadata);\n        if (tag) {\n            manager.addTags([tag], false);\n        }\n        return manager;\n    }\n    async handleToolError(err) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreAgent) {\n                try {\n                    await handler.handleToolError?.(err, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleToolError: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n    async handleToolEnd(output) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreAgent) {\n                try {\n                    await handler.handleToolEnd?.(output, this.runId, this._parentRunId, this.tags);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleToolEnd: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n    }\n}\nexport class CallbackManager extends BaseCallbackManager {\n    constructor(parentRunId) {\n        super();\n        Object.defineProperty(this, \"handlers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inheritableHandlers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"tags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        Object.defineProperty(this, \"inheritableTags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        Object.defineProperty(this, \"metadata\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"inheritableMetadata\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"callback_manager\"\n        });\n        Object.defineProperty(this, \"_parentRunId\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.handlers = [];\n        this.inheritableHandlers = [];\n        this._parentRunId = parentRunId;\n    }\n    async handleLLMStart(llm, prompts, _runId = undefined, _parentRunId = undefined, extraParams = undefined) {\n        return Promise.all(prompts.map(async (prompt) => {\n            const runId = uuidv4();\n            await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n                if (!handler.ignoreLLM) {\n                    try {\n                        await handler.handleLLMStart?.(llm, [prompt], runId, this._parentRunId, extraParams, this.tags, this.metadata);\n                    }\n                    catch (err) {\n                        console.error(`Error in handler ${handler.constructor.name}, handleLLMStart: ${err}`);\n                    }\n                }\n            }, handler.awaitHandlers)));\n            return new CallbackManagerForLLMRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n        }));\n    }\n    async handleChatModelStart(llm, messages, _runId = undefined, _parentRunId = undefined, extraParams = undefined) {\n        return Promise.all(messages.map(async (messageGroup) => {\n            const runId = uuidv4();\n            await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n                if (!handler.ignoreLLM) {\n                    try {\n                        if (handler.handleChatModelStart)\n                            await handler.handleChatModelStart?.(llm, [messageGroup], runId, this._parentRunId, extraParams, this.tags, this.metadata);\n                        else if (handler.handleLLMStart) {\n                            const messageString = getBufferString(messageGroup);\n                            await handler.handleLLMStart?.(llm, [messageString], runId, this._parentRunId, extraParams, this.tags, this.metadata);\n                        }\n                    }\n                    catch (err) {\n                        console.error(`Error in handler ${handler.constructor.name}, handleLLMStart: ${err}`);\n                    }\n                }\n            }, handler.awaitHandlers)));\n            return new CallbackManagerForLLMRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n        }));\n    }\n    async handleChainStart(chain, inputs, runId = uuidv4(), runType = undefined) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreChain) {\n                try {\n                    await handler.handleChainStart?.(chain, inputs, runId, this._parentRunId, this.tags, this.metadata, runType);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleChainStart: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n        return new CallbackManagerForChainRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n    }\n    async handleToolStart(tool, input, runId = uuidv4()) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreAgent) {\n                try {\n                    await handler.handleToolStart?.(tool, input, runId, this._parentRunId, this.tags, this.metadata);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleToolStart: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n        return new CallbackManagerForToolRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n    }\n    async handleRetrieverStart(retriever, query, runId = uuidv4(), _parentRunId = undefined) {\n        await Promise.all(this.handlers.map((handler) => consumeCallback(async () => {\n            if (!handler.ignoreRetriever) {\n                try {\n                    await handler.handleRetrieverStart?.(retriever, query, runId, this._parentRunId, this.tags, this.metadata);\n                }\n                catch (err) {\n                    console.error(`Error in handler ${handler.constructor.name}, handleRetrieverStart: ${err}`);\n                }\n            }\n        }, handler.awaitHandlers)));\n        return new CallbackManagerForRetrieverRun(runId, this.handlers, this.inheritableHandlers, this.tags, this.inheritableTags, this.metadata, this.inheritableMetadata, this._parentRunId);\n    }\n    addHandler(handler, inherit = true) {\n        this.handlers.push(handler);\n        if (inherit) {\n            this.inheritableHandlers.push(handler);\n        }\n    }\n    removeHandler(handler) {\n        this.handlers = this.handlers.filter((_handler) => _handler !== handler);\n        this.inheritableHandlers = this.inheritableHandlers.filter((_handler) => _handler !== handler);\n    }\n    setHandlers(handlers, inherit = true) {\n        this.handlers = [];\n        this.inheritableHandlers = [];\n        for (const handler of handlers) {\n            this.addHandler(handler, inherit);\n        }\n    }\n    addTags(tags, inherit = true) {\n        this.removeTags(tags); // Remove duplicates\n        this.tags.push(...tags);\n        if (inherit) {\n            this.inheritableTags.push(...tags);\n        }\n    }\n    removeTags(tags) {\n        this.tags = this.tags.filter((tag) => !tags.includes(tag));\n        this.inheritableTags = this.inheritableTags.filter((tag) => !tags.includes(tag));\n    }\n    addMetadata(metadata, inherit = true) {\n        this.metadata = { ...this.metadata, ...metadata };\n        if (inherit) {\n            this.inheritableMetadata = { ...this.inheritableMetadata, ...metadata };\n        }\n    }\n    removeMetadata(metadata) {\n        for (const key of Object.keys(metadata)) {\n            delete this.metadata[key];\n            delete this.inheritableMetadata[key];\n        }\n    }\n    copy(additionalHandlers = [], inherit = true) {\n        const manager = new CallbackManager(this._parentRunId);\n        for (const handler of this.handlers) {\n            const inheritable = this.inheritableHandlers.includes(handler);\n            manager.addHandler(handler, inheritable);\n        }\n        for (const tag of this.tags) {\n            const inheritable = this.inheritableTags.includes(tag);\n            manager.addTags([tag], inheritable);\n        }\n        for (const key of Object.keys(this.metadata)) {\n            const inheritable = Object.keys(this.inheritableMetadata).includes(key);\n            manager.addMetadata({ [key]: this.metadata[key] }, inheritable);\n        }\n        for (const handler of additionalHandlers) {\n            if (\n            // Prevent multiple copies of console_callback_handler\n            manager.handlers\n                .filter((h) => h.name === \"console_callback_handler\")\n                .some((h) => h.name === handler.name)) {\n                continue;\n            }\n            manager.addHandler(handler, inherit);\n        }\n        return manager;\n    }\n    static fromHandlers(handlers) {\n        class Handler extends BaseCallbackHandler {\n            constructor() {\n                super();\n                Object.defineProperty(this, \"name\", {\n                    enumerable: true,\n                    configurable: true,\n                    writable: true,\n                    value: uuidv4()\n                });\n                Object.assign(this, handlers);\n            }\n        }\n        const manager = new this();\n        manager.addHandler(new Handler());\n        return manager;\n    }\n    static async configure(inheritableHandlers, localHandlers, inheritableTags, localTags, inheritableMetadata, localMetadata, options) {\n        let callbackManager;\n        if (inheritableHandlers || localHandlers) {\n            if (Array.isArray(inheritableHandlers) || !inheritableHandlers) {\n                callbackManager = new CallbackManager();\n                callbackManager.setHandlers(inheritableHandlers?.map(ensureHandler) ?? [], true);\n            }\n            else {\n                callbackManager = inheritableHandlers;\n            }\n            callbackManager = callbackManager.copy(Array.isArray(localHandlers)\n                ? localHandlers.map(ensureHandler)\n                : localHandlers?.handlers, false);\n        }\n        const verboseEnabled = getEnvironmentVariable(\"LANGCHAIN_VERBOSE\") || options?.verbose;\n        const tracingV2Enabled = getEnvironmentVariable(\"LANGCHAIN_TRACING_V2\") === \"true\";\n        const tracingEnabled = tracingV2Enabled ||\n            (getEnvironmentVariable(\"LANGCHAIN_TRACING\") ?? false);\n        if (verboseEnabled || tracingEnabled) {\n            if (!callbackManager) {\n                callbackManager = new CallbackManager();\n            }\n            if (verboseEnabled &&\n                !callbackManager.handlers.some((handler) => handler.name === ConsoleCallbackHandler.prototype.name)) {\n                const consoleHandler = new ConsoleCallbackHandler();\n                callbackManager.addHandler(consoleHandler, true);\n            }\n            if (tracingEnabled &&\n                !callbackManager.handlers.some((handler) => handler.name === \"langchain_tracer\")) {\n                if (tracingV2Enabled) {\n                    callbackManager.addHandler(await getTracingV2CallbackHandler(), true);\n                }\n                else {\n                    const session = getEnvironmentVariable(\"LANGCHAIN_PROJECT\") &&\n                        getEnvironmentVariable(\"LANGCHAIN_SESSION\");\n                    callbackManager.addHandler(await getTracingCallbackHandler(session), true);\n                }\n            }\n        }\n        if (inheritableTags || localTags) {\n            if (callbackManager) {\n                callbackManager.addTags(inheritableTags ?? []);\n                callbackManager.addTags(localTags ?? [], false);\n            }\n        }\n        if (inheritableMetadata || localMetadata) {\n            if (callbackManager) {\n                callbackManager.addMetadata(inheritableMetadata ?? {});\n                callbackManager.addMetadata(localMetadata ?? {}, false);\n            }\n        }\n        return callbackManager;\n    }\n}\nfunction ensureHandler(handler) {\n    if (\"name\" in handler) {\n        return handler;\n    }\n    return BaseCallbackHandler.fromMethods(handler);\n}\nexport class TraceGroup {\n    constructor(groupName, options) {\n        Object.defineProperty(this, \"groupName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: groupName\n        });\n        Object.defineProperty(this, \"options\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: options\n        });\n        Object.defineProperty(this, \"runManager\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n    }\n    async getTraceGroupCallbackManager(group_name, options) {\n        const cb = new LangChainTracer(options);\n        const cm = await CallbackManager.configure([cb]);\n        const runManager = await cm?.handleChainStart({\n            lc: 1,\n            type: \"not_implemented\",\n            id: [\"langchain\", \"callbacks\", \"groups\", group_name],\n        }, {});\n        if (!runManager) {\n            throw new Error(\"Failed to create run group callback manager.\");\n        }\n        return runManager;\n    }\n    async start() {\n        if (!this.runManager) {\n            this.runManager = await this.getTraceGroupCallbackManager(this.groupName, this.options);\n        }\n        return this.runManager.getChild();\n    }\n    async end() {\n        if (this.runManager) {\n            await this.runManager.handleChainEnd({});\n            this.runManager = undefined;\n        }\n    }\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport async function traceAsGroup(groupOptions, enclosedCode, ...args) {\n    const traceGroup = new TraceGroup(groupOptions.name, groupOptions);\n    const callbackManager = await traceGroup.start();\n    try {\n        return await enclosedCode(callbackManager, ...args);\n    }\n    finally {\n        await traceGroup.end();\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}